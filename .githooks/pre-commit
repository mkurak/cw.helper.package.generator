#!/usr/bin/env bash

set -euo pipefail

run_step() {
    local description="$1"
    shift
    printf '
[cw-package-generator] %s...
' "$description"
    if ! "$@"; then
        printf '
[cw-package-generator] ERROR: %s failed (command: %s)
' "$description" "$*" >&2
        exit 1
    fi
}

run_step "Formatting sources" npm run format

git add --all

run_step "Running lint checks" npm run lint
run_step "Running coverage checks" npm run test:coverage
run_step "Running build" npm run build
run_step "Running smoke test" node scripts/smoke.mjs

printf '
[cw-package-generator] Pre-commit checks passed.
'
exit 0
